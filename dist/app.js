"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const db_1 = require("./db");
const models_1 = require("./models");
const const_1 = require("./const");
const utils_1 = require("./utils");
require('dotenv').config('./.env');
let task = '';
let tmpEmplName = {};
let tmpPatronymic;
const tmpPhone = utils_1.randomPhone();
let tmpAddr = {};
let tmpBuilding = null;
let tmpApartment = 0;
let tmpCity;
let id = -1;
const arg = process.argv[2];
console.log(process.argv[2]);
if (arg) {
    if ((arg === const_1.Task.cashierCreate) && (process.argv.length >= 9)) {
        console.log(`${process.argv[3]}, 
${process.argv[4]}, 
${process.argv[5]}, 
${process.argv[6]}, 
${process.argv[7]},
${process.argv[8]}}`);
        task = arg;
        tmpEmplName = {
            lastName: process.argv[3],
            firstName: process.argv[4],
            patronymic: '',
        };
        tmpCity = models_1.City[process.argv[5]];
        tmpCity = (tmpCity) || models_1.City.Львов;
        console.log(tmpCity);
        tmpAddr = {
            city: tmpCity,
            street: process.argv[6],
            building: process.argv[7],
            apartment: process.argv[8],
        };
    }
    if ((arg === const_1.Task.cashierUpdate) && (process.argv.length >= 7)) {
        id = process.argv[3];
        tmpPatronymic = process.argv[4];
        tmpBuilding = process.argv[5];
        tmpApartment = process.argv[6];
        task = arg;
    }
    if (((arg === const_1.Task.cashierDelete) || (arg === const_1.Task.getCashierById))
        && (process.argv.length >= 4)) {
        console.log(`Target ID is ${process.argv[3]}`);
        task = arg;
        id = process.argv[3];
    }
    if (!task) {
        utils_1.showHelp();
    }
}
else {
    process.argv.forEach((val, index) => {
        console.log(`${index}: ${val}`);
    });
    utils_1.showHelp();
}
const db = new db_1.ShopDB(process.env.DB_PATH);
if (task === const_1.Task.cashierCreate) {
    const newCashier = {
        id: null,
        personnelNumber: utils_1.randomPN(),
        employeeName: tmpEmplName,
        sex: models_1.Sex.female,
        phone: tmpPhone,
        addr: tmpAddr,
        birthday: null,
        shopID: 17,
        startWork: new Date(2021, 2, 18),
        endWork: null,
        lastNet: models_1.Net.Comfy,
    };
    const newCashierId = db.addCashier(newCashier);
    newCashierId.then((value) => {
        newCashier.id = value;
        console.log(newCashier.id);
        const tmpCashier = db.getCashierById(newCashier.id);
        tmpCashier.then((values) => {
            const cashier = values;
            console.log(cashier);
        });
    });
}
if (task === const_1.Task.cashierUpdate) {
    const tmpCashier = db.getCashierById(id);
    tmpCashier.then((values) => {
        const cashier = values;
        console.log(cashier);
        cashier.addr.city = cashier.addr.city;
        cashier.employeeName.patronymic = tmpPatronymic;
        cashier.addr.building = tmpBuilding;
        cashier.addr.apartment = tmpApartment;
        db.updateCashier(cashier);
        console.log(cashier);
    });
}
if (task === const_1.Task.getCashierById) {
    const targetCashier = db.getCashierById(id);
    targetCashier.then((val) => {
        console.log(val);
    });
}
if (task === const_1.Task.cashierDelete) {
    db.completDeleteCashier(id);
}
if (task === const_1.Task.getAllCashiers) {
    db.getAllCashiers();
}
if (task === const_1.Task.useFilter1) {
    const fltr1 = {
        firstName: 'Анна',
        lastNet: models_1.Net['Metro Cash&Carry'],
    };
    db.getAllFiltredCashiers(fltr1);
}
if (task === const_1.Task.useFilter2) {
    const fltr2 = {
        operator: '096',
        city: models_1.City.Мариуполь,
    };
    db.getAllFiltredCashiers(fltr2);
}
if (task === const_1.Task.getTargetCashiers1) {
    db.getTargetCashiers1();
}
if (task === const_1.Task.getTargetCashiers2) {
    db.getTargetCashiers2();
}
if (!task) {
    db.close();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2FwcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUNBLDZCQUE4QjtBQUM5QixxQ0FFa0I7QUFDbEIsbUNBQStCO0FBQy9CLG1DQUEwRDtBQUUxRCxPQUFPLENBQUMsUUFBUSxDQUFDLENBQUMsTUFBTSxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBRW5DLElBQUksSUFBSSxHQUFVLEVBQUUsQ0FBQztBQUVyQixJQUFJLFdBQVcsR0FBYyxFQUFFLENBQUM7QUFDaEMsSUFBSSxhQUFvQixDQUFDO0FBQ3pCLE1BQU0sUUFBUSxHQUFVLG1CQUFXLEVBQUUsQ0FBQztBQUN0QyxJQUFJLE9BQU8sR0FBb0IsRUFBRSxDQUFDO0FBQ2xDLElBQUksV0FBVyxHQUFPLElBQUksQ0FBQztBQUMzQixJQUFJLFlBQVksR0FBVSxDQUFDLENBQUM7QUFDNUIsSUFBSSxPQUFnQixDQUFDO0FBQ3JCLElBQUksRUFBRSxHQUFVLENBQUMsQ0FBQyxDQUFDO0FBRW5CLE1BQU0sR0FBRyxHQUFVLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDbkMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDN0IsSUFBSSxHQUFHLEVBQUU7SUFDUCxJQUFJLENBQUMsR0FBRyxLQUFLLFlBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsTUFBTSxJQUFJLENBQUMsQ0FBQyxFQUFFO1FBQzlELE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztFQUNoQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztFQUNmLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0VBQ2YsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7RUFDZixPQUFPLENB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WUFBSSxDQUFDLGtCQUFrQixFQUFFO0lBQ3BDLEVBQUUsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO0NBQ3pCO0FBR0QsSUFBSSxJQUFJLEtBQUssWUFBSSxDQUFDLGtCQUFrQixFQUFFO0lBQ3BDLEVBQUUsQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO0NBQ3pCO0FBR0QsSUFBSSxDQUFDLElBQUksRUFBRTtJQUNULEVBQUUsQ0FBQyxLQUFLLEVBQUUsQ0FBQztDQUNaIiwic291cmNlc0NvbnRlbnQiOlsiLy8gYXBwIG1haW4gcG9pbnQ7XG5pbXBvcnQgeyBTaG9wREIgfSBmcm9tICcuL2RiJztcbmltcG9ydCB7XG4gIElDYXNoaWVyLCBTZXgsIENpdHksIE5ldCwgU3FsRmlsdGVyLCBOYW1lLCBBZGRyZXNzLFxufSBmcm9tICcuL21vZGVscyc7XG5pbXBvcnQgeyBUYXNrIH0gZnJvbSAnLi9jb25zdCc7XG5pbXBvcnQgeyByYW5kb21QaG9uZSwgcmFuZG9tUE4sIHNob3dIZWxwIH0gZnJvbSAnLi91dGlscyc7XG5cbnJlcXVpcmUoJ2RvdGVudicpLmNvbmZpZygnLi8uZW52Jyk7XG5cbmxldCB0YXNrOnN0cmluZyA9ICcnO1xuXG5sZXQgdG1wRW1wbE5hbWU6TmFtZSA9IDxOYW1lPnt9O1xubGV0IHRtcFBhdHJvbnltaWM6c3RyaW5nO1xuY29uc3QgdG1wUGhvbmU6c3RyaW5nID0gcmFuZG9tUGhvbmUoKTtcbmxldCB0bXBBZGRyOkFkZHJlc3MgPSA8QWRkcmVzcz57fTtcbmxldCB0bXBCdWlsZGluZzphbnkgPSBudWxsO1xubGV0IHRtcEFwYXJ0bWVudDpudW1iZXIgPSAwO1xubGV0IHRtcENpdHk6Q2l0eXxhbnk7XG5sZXQgaWQ6bnVtYmVyID0gLTE7XG5cbmNvbnN0IGFyZzpzdHJpbmcgPSBwcm9jZXNzLmFyZ3ZbMl07XG5jb25zb2xlLmxvZyhwcm9jZXNzLmFyZ3ZbMl0pO1xuaWYgKGFyZykge1xuICBpZiAoKGFyZyA9PT0gVGFzay5jYXNoaWVyQ3JlYXRlKSAmJiAocHJvY2Vzcy5hcmd2Lmxlbmd0aCA+PSA5KSkge1xuICAgIGNvbnNvbGUubG9nKGAke3Byb2Nlc3MuYXJndlszXX0sIFxuJHtwcm9jZXNzLmFyZ3ZbNF19LCBcbiR7cHJvY2Vzcy5hcmd2WzVdfSwgXG4ke3Byb2Nlc3MuYXJndls2XX0sIFxuJHtwcm9jZXNzLmFyZ3ZbN119LFxuJHtwcm9jZXNzLmFyZ3ZbOF19fWApO1xuXG4gICAgdGFzayA9IGFyZztcbiAgICB0bXBFbXBsTmFtZSA9IHtcbiAgICAgIGxhc3ROYW1lOiBwcm9jZXNzLmFyZ3ZbM10sXG4gICAgICBmaXJzdE5hbWU6IHByb2Nlc3MuYXJndls0XSxcbiAgICAgIHBhdHJvbnltaWM6ICcnLFxuICAgIH07XG5cbiAgICB0bXBDaXR5ID0gQ2l0eVtwcm9jZXNzLmFyZ3ZbNV0gYXMgYW55XTtcbiAgICB0bXBDaXR5ID0gKHRtcENpdHkpIHx8IENpdHku0JvRjNCy0L7QsjtcbiAgICBjb25zb2xlLmxvZyh0bXBDaXR5KTtcblxuICAgIHRtcEFkZHIgPSB7XG4gICAgICBjaXR5OiB0bXBDaXR5LFxuICAgICAgc3RyZWV0OiBwcm9jZXNzLmFyZ3ZbNl0sXG4gICAgICBidWlsZGluZzogcHJvY2Vzcy5hcmd2WzddIGFzIHVua25vd24gYXMgbnVtYmVyLFxuICAgICAgYXBhcnRtZW50OiBwcm9jZXNzLmFyZ3ZbOF0gYXMgdW5rbm93biBhcyBudW1iZXIsXG4gICAgfTtcbiAgfVxuXG4gIGlmICgoYXJnID09PSBUYXNrLmNhc2hpZXJVcGRhdGUpICYmIChwcm9jZXNzLmFyZ3YubGVuZ3RoID49IDcpKSB7XG4gICAgaWQgPSBwcm9jZXNzLmFyZ3ZbM10gYXMgdW5rbm93biBhcyBudW1iZXI7XG4gICAgdG1wUGF0cm9ueW1pYyA9IHByb2Nlc3MuYXJndls0XTtcbiAgICB0bXBCdWlsZGluZyA9IHByb2Nlc3MuYXJndls1XSBhcyB1bmtub3duIGFzIG51bWJlcjtcbiAgICB0bXBBcGFydG1lbnQgPSBwcm9jZXNzLmFyZ3ZbNl0gYXMgdW5rbm93biBhcyBudW1iZXI7XG4gICAgdGFzayA9IGFyZztcbiAgfVxuXG4gIGlmICgoKGFyZyA9PT0gVGFzay5jYXNoaWVyRGVsZXRlKSB8fCAoYXJnID09PSBUYXNrLmdldENhc2hpZXJCeUlkKSlcbiAgICAgICAgICAmJiAocHJvY2Vzcy5hcmd2Lmxlbmd0aCA+PSA0KSkge1xuICAgIGNvbnNvbGUubG9nKGBUYXJnZXQgSUQgaXMgJHtwcm9jZXNzLmFyZ3ZbM119YCk7XG4gICAgdGFzayA9IGFyZztcbiAgICBpZCA9IHByb2Nlc3MuYXJndlszXSBhcyB1bmtub3duIGFzIG51bWJlcjtcbiAgfVxuXG4gIGlmICghdGFzaykge1xuICAgIHNob3dIZWxwKCk7XG4gIH1cbn0gZWxzZSB7XG4gIHByb2Nlc3MuYXJndi5mb3JFYWNoKCh2YWwsIGluZGV4KSA9PiB7XG4gICAgY29uc29sZS5sb2coYCR7aW5kZXh9OiAke3ZhbH1gKTtcbiAgfSk7XG4gIHNob3dIZWxwKCk7XG59XG5cbi8vIGNvbm5lY3RpbmcgdG8gdGhlIHNob3AgREIgKGxvZ2luIGFuZCBwYXNzd29yZCBub3QgcmVxdWlyZSlcbmNvbnN0IGRiID0gbmV3IFNob3BEQihwcm9jZXNzLmVudi5EQl9QQVRIIGFzIHN0cmluZyk7XG5cbi8vIGNyZWF0aW5nIGEgbmV3IENhc2hlaXIsIGdldCBpbmZvcm1hdGlvbiBhYm91dCBpdCBhbmQgdXBkYXRlIHNvbWUgZmllbGRzXG5pZiAodGFzayA9PT0gVGFzay5jYXNoaWVyQ3JlYXRlKSB7XG4gIGNvbnN0IG5ld0Nhc2hpZXI6SUNhc2hpZXIgPSB7XG4gICAgaWQ6IG51bGwsXG4gICAgcGVyc29ubmVsTnVtYmVyOiByYW5kb21QTigpLFxuICAgIGVtcGxveWVlTmFtZTogdG1wRW1wbE5hbWUsXG4gICAgc2V4OiBTZXguZmVtYWxlLFxuICAgIHBob25lOiB0bXBQaG9uZSxcbiAgICBhZGRyOiB0bXBBZGRyLFxuICAgIGJpcnRoZGF5OiBudWxsLFxuICAgIHNob3BJRDogMTcsXG4gICAgc3RhcnRXb3JrOiBuZXcgRGF0ZSgyMDIxLCAyLCAxOCksIC8vIE1vbnRoIGluIDAtMTFcbiAgICBlbmRXb3JrOiBudWxsLFxuICAgIGxhc3ROZXQ6IE5ldC5Db21meSxcbiAgfTtcblxuICAvLyBhZGRpbmcgY3JlYXRlZCBDYXNoaWVyIHRvIHRoZSBEQlxuICBjb25zdCBuZXdDYXNoaWVySWQ6UHJvbWlzZTxudW1iZXI+ID0gZGIuYWRkQ2FzaGllcihuZXdDYXNoaWVyKTtcbiAgbmV3Q2FzaGllcklkLnRoZW4oKHZhbHVlKSA9PiB7XG4gICAgbmV3Q2FzaGllci5pZCA9IHZhbHVlO1xuICAgIGNvbnNvbGUubG9nKG5ld0Nhc2hpZXIuaWQpO1xuXG4gICAgLy8gZ2V0dGluZyBpbmZvcm1hdGlvbiBhYm91dCBjYXNoaWVyIHdpdGggbmV3Q2FzaGllci5pZFxuICAgIGNvbnN0IHRtcENhc2hpZXI6UHJvbWlzZTxJQ2FzaGllcj4gPSBkYi5nZXRDYXNoaWVyQnlJZChuZXdDYXNoaWVyLmlkKTtcbiAgICB0bXBDYXNoaWVyLnRoZW4oKHZhbHVlcykgPT4ge1xuICAgICAgY29uc3QgY2FzaGllcjpJQ2FzaGllciA9IHZhbHVlcztcbiAgICAgIGNvbnNvbGUubG9nKGNhc2hpZXIpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuaWYgKHRhc2sgPT09IFRhc2suY2FzaGllclVwZGF0ZSkge1xuICAvLyBnZXR0aW5nIGluZm9ybWF0aW9uIGFib3V0IGNhc2hpZXIgd2l0aCBuZXdDYXNoaWVyLmlkIGFuZCB1cGRhdGluZyBpdFxuICBjb25zdCB0bXBDYXNoaWVyOlByb21pc2U8SUNhc2hpZXI+ID0gZGIuZ2V0Q2FzaGllckJ5SWQoaWQpO1xuICB0bXBDYXNoaWVyLnRoZW4oKHZhbHVlcykgPT4ge1xuICAgIGNvbnN0IGNhc2hpZXI6SUNhc2hpZXIgPSB2YWx1ZXM7XG4gICAgY29uc29sZS5sb2coY2FzaGllcik7XG5cbiAgICAvLyB1cGRhdGluZyBpbmZvcm1hdGlvbiBhYm91dCBjYXNoaWVyXG4gICAgY2FzaGllci5hZGRyLmNpdHkgPSBjYXNoaWVyLmFkZHIuY2l0eSBhcyB1bmtub3duIGFzIG51bWJlcjtcbiAgICBjYXNoaWVyLmVtcGxveWVlTmFtZS5wYXRyb255bWljID0gdG1wUGF0cm9ueW1pYztcbiAgICBjYXNoaWVyLmFkZHIuYnVpbGRpbmcgPSB0bXBCdWlsZGluZztcbiAgICBjYXNoaWVyLmFkZHIuYXBhcnRtZW50ID0gdG1wQXBhcnRtZW50O1xuICAgIGRiLnVwZGF0ZUNhc2hpZXIoY2FzaGllcik7XG4gICAgY29uc29sZS5sb2coY2FzaGllcik7XG4gIH0pO1xufVxuXG4vLyBnZXR0aW5nIGluZm9ybWF0aW9uIGFib3V0IGNhc2hpZXIgYnkgaWRcbmlmICh0YXNrID09PSBUYXNrLmdldENhc2hpZXJCeUlkKSB7XG4gIGNvbnN0IHRhcmdldENhc2hpZXI6UHJvbWlzZTxJQ2FzaGllcj4gPSBkYi5nZXRDYXNoaWVyQnlJZChpZCk7XG4gIHRhcmdldENhc2hpZXIudGhlbigodmFsKSA9PiB7XG4gICAgY29uc29sZS5sb2codmFsKTtcbiAgfSk7XG59XG5cbi8vIGRlbGV0aW5nIGluZm9ybWF0aW9uIGFib3V0IGNhc2hpZXIgd2l0aCBzb21lIGlkXG5pZiAodGFzayA9PT0gVGFzay5jYXNoaWVyRGVsZXRlKSB7XG4vLyBkYi5kZWxDYXNoaWVyKDIwKTtcbiAgZGIuY29tcGxldERlbGV0ZUNhc2hpZXIoaWQpO1xufVxuLy8gZ2V0dGluZyBpbmZvIGFib3V0IGFsbCBjYXNoaWVyc1xuaWYgKHRhc2sgPT09IFRhc2suZ2V0QWxsQ2FzaGllcnMpIHtcbiAgZGIuZ2V0QWxsQ2FzaGllcnMoKTtcbn1cblxuLy8gZ2V0dGluZyBpbmZvIGFib3V0IGFsbCBjYXNoaWVycyBhY2NvcmRpbmcgc29tZSBmaWx0ZXJzXG4vLyBnZXQgYWxsIGNhc2hpZXJzIHdpdGggZmlyc3QgbmFtZSBBbm5hIHdoaWNoIHdvcmtlZCBpbiBNZXRybyBDYXNoJkNhcnJ5XG5pZiAodGFzayA9PT0gVGFzay51c2VGaWx0ZXIxKSB7XG4gIGNvbnN0IGZsdHIxOlNxbEZpbHRlciA9IHtcbiAgICBmaXJzdE5hbWU6ICfQkNC90L3QsCcsXG4gICAgbGFzdE5ldDogTmV0WydNZXRybyBDYXNoJkNhcnJ5J10sXG4gIH07XG4gIGRiLmdldEFsbEZpbHRyZWRDYXNoaWVycyhmbHRyMSk7XG59XG5cbi8vIGdldCBhbGwgY2FzaGllcnMgZnJvbSBNYXJpdXBvbCBhbmQgcGhvbmUgbnVtYmVyIHdpdGggY29kZSBvcGVyYXRvciAwOTZcbmlmICh0YXNrID09PSBUYXNrLnVzZUZpbHRlcjIpIHtcbiAgY29uc3QgZmx0cjIgPSB7XG4gICAgb3BlcmF0b3I6ICcwOTYnLFxuICAgIGNpdHk6IENpdHku0JzQsNGA0LjRg9C/0L7Qu9GMLFxuICB9O1xuICBkYi5nZXRBbGxGaWx0cmVkQ2FzaGllcnMoZmx0cjIpO1xufVxuXG4vLyBnZXR0aW5nIGluZm9ybWF0aW9uIGFib3V0IGNhc2hpZXIgd2l0aCBhIHNwZWNpYWwgZmlsdGVyXzFcbmlmICh0YXNrID09PSBUYXNrLmdldFRhcmdldENhc2hpZXJzMSkge1xuICBkYi5nZXRUYXJnZXRDYXNoaWVyczEoKTtcbn1cblxuLy8gZ2V0dGluZyBpbmZvcm1hdGlvbiBhYm91dCBjYXNoaWVyIHdpdGggYSBzcGVjaWFsIGZpbHRlcl8yXG5pZiAodGFzayA9PT0gVGFzay5nZXRUYXJnZXRDYXNoaWVyczIpIHtcbiAgZGIuZ2V0VGFyZ2V0Q2FzaGllcnMyKCk7XG59XG5cbi8vIGNsb3NlIERCIGFuZCBjb25uZWN0aW9uXG5pZiAoIXRhc2spIHtcbiAgZGIuY2xvc2UoKTtcbn1cbiJdfQ==