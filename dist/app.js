"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const db_1 = require("./db");
const models_1 = require("./models");
const const_1 = require("./const");
const utils_1 = require("./utils");
let task = '';
let tmpEmplName = {};
let tmpPatronymic = '';
const tmpPhone = utils_1.randomPhone();
let tmpAddr = {};
let tmpBuilding = null;
let tmpApartment = 0;
let tmpCity;
let id = -1;
const arg = process.argv[2];
console.log(process.argv[2]);
if (arg) {
    if ((arg === const_1.Task.cashierCreate) && (process.argv.length >= 9)) {
        console.log(`${process.argv[3]}, 
${process.argv[4]}, 
${process.argv[5]}, 
${process.argv[6]}, 
${process.argv[7]},
${process.argv[8]}}`);
        task = arg;
        tmpEmplName = {
            lastName: process.argv[3],
            firstName: process.argv[4],
            patronymic: '',
        };
        tmpCity = models_1.City[process.argv[5]];
        tmpCity = (tmpCity) || models_1.City.Львов;
        console.log(tmpCity);
        tmpAddr = {
            city: tmpCity,
            street: process.argv[6],
            building: null,
            apartment: null,
        };
    }
    if ((arg === const_1.Task.cashierUpdate) && (process.argv.length >= 7)) {
        id = process.argv[3];
        tmpPatronymic = process.argv[4];
        tmpBuilding = process.argv[5];
        tmpApartment = process.argv[6];
        task = arg;
    }
    if (((arg === const_1.Task.cashierDelete) || (arg === const_1.Task.getCashierById))
        && (process.argv.length >= 4)) {
        console.log(`Target ID is ${process.argv[3]}`);
        task = arg;
        id = process.argv[3];
    }
    if (!task) {
        utils_1.showHelp();
    }
}
else {
    process.argv.forEach((val, index) => {
        console.log(`${index}: ${val}`);
    });
    utils_1.showHelp();
}
const db = new db_1.ShopDB('db.sqlite');
if (task === const_1.Task.cashierCreate) {
    const newCashier = {
        id: null,
        personnelNumber: utils_1.randomPN(),
        employeeName: tmpEmplName,
        sex: models_1.Sex.female,
        phone: tmpPhone,
        addr: tmpAddr,
        birthday: null,
        shopID: 17,
        startWork: new Date(2021, 2, 18),
        endWork: null,
        lastNet: models_1.Net.Comfy,
    };
    const newCashierId = db.addCashier(newCashier);
    newCashierId.then((value) => {
        newCashier.id = value;
        console.log(newCashier.id);
        const tmpCashier = db.getCashierById(newCashier.id);
        tmpCashier.then((values) => {
            const cashier = values;
            console.log(cashier);
        });
    });
}
if (task === const_1.Task.cashierUpdate) {
    const tmpCashier = db.getCashierById(id);
    tmpCashier.then((values) => {
        const cashier = values;
        console.log(cashier);
        cashier.addr.city = cashier.addr.city;
        cashier.employeeName.patronymic = tmpPatronymic;
        cashier.addr.building = tmpBuilding;
        cashier.addr.apartment = tmpApartment;
        db.updateCashier(cashier);
        console.log(cashier);
    });
}
if (task === const_1.Task.getCashierById) {
    const targetCashier = db.getCashierById(id);
    targetCashier.then((val) => {
        console.log(val);
    });
}
if (task === const_1.Task.cashierDelete) {
    db.completDeleteCashier(id);
}
if (task === const_1.Task.getAllCashiers) {
    db.getAllCashiers();
}
if (task === const_1.Task.useFilter1) {
    const fltr1 = {
        firstName: 'Анна',
        lastNet: models_1.Net['Metro Cash&Carry'],
    };
    db.getAllFiltredCashiers(fltr1);
}
if (task === const_1.Task.useFilter2) {
    const fltr2 = {
        operator: '096',
        city: models_1.City.Мариуполь,
    };
    db.getAllFiltredCashiers(fltr2);
}
if (task === const_1.Task.getTargetCashiers1) {
    db.getTargetCashiers1();
}
if (task === const_1.Task.getTargetCashiers2) {
    db.getTargetCashiers2();
}
if (!task) {
    db.close();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXBwLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2FwcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUVBLDZCQUE4QjtBQUM5QixxQ0FFa0I7QUFDbEIsbUNBQStCO0FBQy9CLG1DQUEwRDtBQUUxRCxJQUFJLElBQUksR0FBVSxFQUFFLENBQUM7QUFFckIsSUFBSSxXQUFXLEdBQWMsRUFBRSxDQUFDO0FBQ2hDLElBQUksYUFBYSxHQUFVLEVBQUUsQ0FBQztBQUM5QixNQUFNLFFBQVEsR0FBVSxtQkFBVyxFQUFFLENBQUM7QUFDdEMsSUFBSSxPQUFPLEdBQW9CLEVBQUUsQ0FBQztBQUNsQyxJQUFJLFdBQVcsR0FBTyxJQUFJLENBQUM7QUFDM0IsSUFBSSxZQUFZLEdBQVUsQ0FBQyxDQUFDO0FBQzVCLElBQUksT0FBZ0IsQ0FBQztBQUNyQixJQUFJLEVBQUUsR0FBVSxDQUFDLENBQUMsQ0FBQztBQUVuQixNQUFNLEdBQUcsR0FBVSxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQ25DLE9BQU8sQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzdCLElBQUksR0FBRyxFQUFFO0lBQ1AsSUFBSSxDQUFDLEdBQUcsS0FBSyxZQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLE1BQU0sSUFBSSxDQUFDLENBQUMsRUFBRTtRQUM5RCxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7RUFDaEMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7RUFDZixPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztFQUNmLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO0VBQ2YsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUM7RUFDZixPQUFPLENBQUMsSUFBSSxDQUFD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QUFrQixFQUFFLENBQUM7Q0FDekI7QUFHRCxJQUFJLENBQUMsSUFBSSxFQUFFO0lBQ1QsRUFBRSxDQUFDLEtBQUssRUFBRSxDQUFDO0NBQ1oiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBhcHAgbWFpbiBwb2ludDtcbi8vIEltcG9ydCBkZXBlbmRlbmNpZXNcbmltcG9ydCB7IFNob3BEQiB9IGZyb20gJy4vZGInO1xuaW1wb3J0IHtcbiAgSUNhc2hpZXIsIFNleCwgQ2l0eSwgTmV0LCBTcWxGaWx0ZXIsIE5hbWUsIEFkZHJlc3MsXG59IGZyb20gJy4vbW9kZWxzJztcbmltcG9ydCB7IFRhc2sgfSBmcm9tICcuL2NvbnN0JztcbmltcG9ydCB7IHJhbmRvbVBob25lLCByYW5kb21QTiwgc2hvd0hlbHAgfSBmcm9tICcuL3V0aWxzJztcblxubGV0IHRhc2s6c3RyaW5nID0gJyc7XG5cbmxldCB0bXBFbXBsTmFtZTpOYW1lID0gPE5hbWU+e307XG5sZXQgdG1wUGF0cm9ueW1pYzpzdHJpbmcgPSAnJztcbmNvbnN0IHRtcFBob25lOnN0cmluZyA9IHJhbmRvbVBob25lKCk7XG5sZXQgdG1wQWRkcjpBZGRyZXNzID0gPEFkZHJlc3M+e307XG5sZXQgdG1wQnVpbGRpbmc6YW55ID0gbnVsbDtcbmxldCB0bXBBcGFydG1lbnQ6bnVtYmVyID0gMDtcbmxldCB0bXBDaXR5OkNpdHl8YW55O1xubGV0IGlkOm51bWJlciA9IC0xO1xuXG5jb25zdCBhcmc6c3RyaW5nID0gcHJvY2Vzcy5hcmd2WzJdO1xuY29uc29sZS5sb2cocHJvY2Vzcy5hcmd2WzJdKTtcbmlmIChhcmcpIHtcbiAgaWYgKChhcmcgPT09IFRhc2suY2FzaGllckNyZWF0ZSkgJiYgKHByb2Nlc3MuYXJndi5sZW5ndGggPj0gOSkpIHtcbiAgICBjb25zb2xlLmxvZyhgJHtwcm9jZXNzLmFyZ3ZbM119LCBcbiR7cHJvY2Vzcy5hcmd2WzRdfSwgXG4ke3Byb2Nlc3MuYXJndls1XX0sIFxuJHtwcm9jZXNzLmFyZ3ZbNl19LCBcbiR7cHJvY2Vzcy5hcmd2WzddfSxcbiR7cHJvY2Vzcy5hcmd2WzhdfX1gKTtcblxuICAgIHRhc2sgPSBhcmc7XG4gICAgdG1wRW1wbE5hbWUgPSB7XG4gICAgICBsYXN0TmFtZTogcHJvY2Vzcy5hcmd2WzNdLFxuICAgICAgZmlyc3ROYW1lOiBwcm9jZXNzLmFyZ3ZbNF0sXG4gICAgICBwYXRyb255bWljOiAnJyxcbiAgICB9O1xuXG4gICAgdG1wQ2l0eSA9IENpdHlbcHJvY2Vzcy5hcmd2WzVdIGFzIGFueV07XG4gICAgdG1wQ2l0eSA9ICh0bXBDaXR5KSB8fCBDaXR5LtCb0YzQstC+0LI7XG4gICAgY29uc29sZS5sb2codG1wQ2l0eSk7XG5cbiAgICB0bXBBZGRyID0ge1xuICAgICAgY2l0eTogdG1wQ2l0eSxcbiAgICAgIHN0cmVldDogcHJvY2Vzcy5hcmd2WzZdLFxuICAgICAgYnVpbGRpbmc6IG51bGwsIC8vIGZvciB0aGUgZnV0dXJ0ZSB1cGRhdGVcbiAgICAgIGFwYXJ0bWVudDogbnVsbCwgLy8gZm9yIHRoZSBmdXR1cnRlIHVwZGF0ZVxuICAgIH07XG4gIH1cblxuICBpZiAoKGFyZyA9PT0gVGFzay5jYXNoaWVyVXBkYXRlKSAmJiAocHJvY2Vzcy5hcmd2Lmxlbmd0aCA+PSA3KSkge1xuICAgIGlkID0gcHJvY2Vzcy5hcmd2WzNdIGFzIHVua25vd24gYXMgbnVtYmVyO1xuICAgIHRtcFBhdHJvbnltaWMgPSBwcm9jZXNzLmFyZ3ZbNF07IC8vIGZvciB0aGUgZnV0dXJ0ZSB1cGRhdGVcbiAgICB0bXBCdWlsZGluZyA9IHByb2Nlc3MuYXJndls1XSBhcyB1bmtub3duIGFzIG51bWJlcjtcbiAgICB0bXBBcGFydG1lbnQgPSBwcm9jZXNzLmFyZ3ZbNl0gYXMgdW5rbm93biBhcyBudW1iZXI7XG4gICAgdGFzayA9IGFyZztcbiAgfVxuXG4gIGlmICgoKGFyZyA9PT0gVGFzay5jYXNoaWVyRGVsZXRlKSB8fCAoYXJnID09PSBUYXNrLmdldENhc2hpZXJCeUlkKSlcbiAgICAgICAgICAmJiAocHJvY2Vzcy5hcmd2Lmxlbmd0aCA+PSA0KSkge1xuICAgIGNvbnNvbGUubG9nKGBUYXJnZXQgSUQgaXMgJHtwcm9jZXNzLmFyZ3ZbM119YCk7XG4gICAgdGFzayA9IGFyZztcbiAgICBpZCA9IHByb2Nlc3MuYXJndlszXSBhcyB1bmtub3duIGFzIG51bWJlcjtcbiAgfVxuXG4gIGlmICghdGFzaykge1xuICAgIHNob3dIZWxwKCk7XG4gIH1cbn0gZWxzZSB7XG4gIHByb2Nlc3MuYXJndi5mb3JFYWNoKCh2YWwsIGluZGV4KSA9PiB7XG4gICAgY29uc29sZS5sb2coYCR7aW5kZXh9OiAke3ZhbH1gKTtcbiAgfSk7XG4gIHNob3dIZWxwKCk7XG59XG5cbi8vIGNvbm5lY3RpbmcgdG8gdGhlIHNob3AgREIgKGxvZ2luIGFuZCBwYXNzd29yZCBub3QgcmVxdWlyZSlcbmNvbnN0IGRiID0gbmV3IFNob3BEQignZGIuc3FsaXRlJyk7XG5cbi8vIGNyZWF0aW5nIGEgbmV3IENhc2hlaXIsIGdldCBpbmZvcm1hdGlvbiBhYm91dCBpdCBhbmQgdXBkYXRlIHNvbWUgZmllbGRzXG5pZiAodGFzayA9PT0gVGFzay5jYXNoaWVyQ3JlYXRlKSB7XG4gIGNvbnN0IG5ld0Nhc2hpZXI6SUNhc2hpZXIgPSB7XG4gICAgaWQ6IG51bGwsXG4gICAgcGVyc29ubmVsTnVtYmVyOiByYW5kb21QTigpLFxuICAgIGVtcGxveWVlTmFtZTogdG1wRW1wbE5hbWUsXG4gICAgc2V4OiBTZXguZmVtYWxlLFxuICAgIHBob25lOiB0bXBQaG9uZSxcbiAgICBhZGRyOiB0bXBBZGRyLFxuICAgIGJpcnRoZGF5OiBudWxsLFxuICAgIHNob3BJRDogMTcsXG4gICAgc3RhcnRXb3JrOiBuZXcgRGF0ZSgyMDIxLCAyLCAxOCksIC8vIE1vbnRoIGluIDAtMTFcbiAgICBlbmRXb3JrOiBudWxsLFxuICAgIGxhc3ROZXQ6IE5ldC5Db21meSxcbiAgfTtcblxuICAvLyBhZGRpbmcgY3JlYXRlZCBDYXNoaWVyIHRvIHRoZSBEQlxuICBjb25zdCBuZXdDYXNoaWVySWQ6UHJvbWlzZTxudW1iZXI+ID0gZGIuYWRkQ2FzaGllcihuZXdDYXNoaWVyKTtcbiAgbmV3Q2FzaGllcklkLnRoZW4oKHZhbHVlKSA9PiB7XG4gICAgbmV3Q2FzaGllci5pZCA9IHZhbHVlO1xuICAgIGNvbnNvbGUubG9nKG5ld0Nhc2hpZXIuaWQpO1xuXG4gICAgLy8gZ2V0dGluZyBpbmZvcm1hdGlvbiBhYm91dCBjYXNoaWVyIHdpdGggbmV3Q2FzaGllci5pZFxuICAgIGNvbnN0IHRtcENhc2hpZXI6UHJvbWlzZTxJQ2FzaGllcj4gPSBkYi5nZXRDYXNoaWVyQnlJZChuZXdDYXNoaWVyLmlkKTtcbiAgICB0bXBDYXNoaWVyLnRoZW4oKHZhbHVlcykgPT4ge1xuICAgICAgY29uc3QgY2FzaGllcjpJQ2FzaGllciA9IHZhbHVlcztcbiAgICAgIGNvbnNvbGUubG9nKGNhc2hpZXIpO1xuICAgIH0pO1xuICB9KTtcbn1cblxuaWYgKHRhc2sgPT09IFRhc2suY2FzaGllclVwZGF0ZSkge1xuICAvLyBnZXR0aW5nIGluZm9ybWF0aW9uIGFib3V0IGNhc2hpZXIgd2l0aCBuZXdDYXNoaWVyLmlkIGFuZCB1cGRhdGluZyBpdFxuICBjb25zdCB0bXBDYXNoaWVyOlByb21pc2U8SUNhc2hpZXI+ID0gZGIuZ2V0Q2FzaGllckJ5SWQoaWQpO1xuICB0bXBDYXNoaWVyLnRoZW4oKHZhbHVlcykgPT4ge1xuICAgIGNvbnN0IGNhc2hpZXI6SUNhc2hpZXIgPSB2YWx1ZXM7XG4gICAgY29uc29sZS5sb2coY2FzaGllcik7XG5cbiAgICAvLyB1cGRhdGluZyBpbmZvcm1hdGlvbiBhYm91dCBjYXNoaWVyXG4gICAgY2FzaGllci5hZGRyLmNpdHkgPSBjYXNoaWVyLmFkZHIuY2l0eSBhcyB1bmtub3duIGFzIG51bWJlcjtcbiAgICBjYXNoaWVyLmVtcGxveWVlTmFtZS5wYXRyb255bWljID0gdG1wUGF0cm9ueW1pYztcbiAgICBjYXNoaWVyLmFkZHIuYnVpbGRpbmcgPSB0bXBCdWlsZGluZztcbiAgICBjYXNoaWVyLmFkZHIuYXBhcnRtZW50ID0gdG1wQXBhcnRtZW50O1xuICAgIGRiLnVwZGF0ZUNhc2hpZXIoY2FzaGllcik7XG4gICAgY29uc29sZS5sb2coY2FzaGllcik7XG4gIH0pO1xufVxuXG4vLyBnZXR0aW5nIGluZm9ybWF0aW9uIGFib3V0IGNhc2hpZXIgYnkgaWRcbmlmICh0YXNrID09PSBUYXNrLmdldENhc2hpZXJCeUlkKSB7XG4gIGNvbnN0IHRhcmdldENhc2hpZXI6UHJvbWlzZTxJQ2FzaGllcj4gPSBkYi5nZXRDYXNoaWVyQnlJZChpZCk7XG4gIHRhcmdldENhc2hpZXIudGhlbigodmFsKSA9PiB7XG4gICAgY29uc29sZS5sb2codmFsKTtcbiAgfSk7XG59XG5cbi8vIGRlbGV0aW5nIGluZm9ybWF0aW9uIGFib3V0IGNhc2hpZXIgd2l0aCBzb21lIGlkXG5pZiAodGFzayA9PT0gVGFzay5jYXNoaWVyRGVsZXRlKSB7XG4vLyBkYi5kZWxDYXNoaWVyKDIwKTtcbiAgZGIuY29tcGxldERlbGV0ZUNhc2hpZXIoaWQpO1xufVxuLy8gZ2V0dGluZyBpbmZvIGFib3V0IGFsbCBjYXNoaWVyc1xuaWYgKHRhc2sgPT09IFRhc2suZ2V0QWxsQ2FzaGllcnMpIHtcbiAgZGIuZ2V0QWxsQ2FzaGllcnMoKTtcbn1cblxuLy8gZ2V0dGluZyBpbmZvIGFib3V0IGFsbCBjYXNoaWVycyBhY2NvcmRpbmcgc29tZSBmaWx0ZXJzXG4vLyBnZXQgYWxsIGNhc2hpZXJzIHdpdGggZmlyc3QgbmFtZSBBbm5hIHdoaWNoIHdvcmtlZCBpbiBNZXRybyBDYXNoJkNhcnJ5XG5pZiAodGFzayA9PT0gVGFzay51c2VGaWx0ZXIxKSB7XG4gIGNvbnN0IGZsdHIxOlNxbEZpbHRlciA9IHtcbiAgICBmaXJzdE5hbWU6ICfQkNC90L3QsCcsXG4gICAgbGFzdE5ldDogTmV0WydNZXRybyBDYXNoJkNhcnJ5J10sXG4gIH07XG4gIGRiLmdldEFsbEZpbHRyZWRDYXNoaWVycyhmbHRyMSk7XG59XG5cbi8vIGdldCBhbGwgY2FzaGllcnMgZnJvbSBNYXJpdXBvbCBhbmQgcGhvbmUgbnVtYmVyIHdpdGggY29kZSBvcGVyYXRvciAwOTZcbmlmICh0YXNrID09PSBUYXNrLnVzZUZpbHRlcjIpIHtcbiAgY29uc3QgZmx0cjIgPSB7XG4gICAgb3BlcmF0b3I6ICcwOTYnLFxuICAgIGNpdHk6IENpdHku0JzQsNGA0LjRg9C/0L7Qu9GMLFxuICB9O1xuICBkYi5nZXRBbGxGaWx0cmVkQ2FzaGllcnMoZmx0cjIpO1xufVxuXG4vLyBnZXR0aW5nIGluZm9ybWF0aW9uIGFib3V0IGNhc2hpZXIgd2l0aCBhIHNwZWNpYWwgZmlsdGVyXzFcbmlmICh0YXNrID09PSBUYXNrLmdldFRhcmdldENhc2hpZXJzMSkge1xuICBkYi5nZXRUYXJnZXRDYXNoaWVyczEoKTtcbn1cblxuLy8gZ2V0dGluZyBpbmZvcm1hdGlvbiBhYm91dCBjYXNoaWVyIHdpdGggYSBzcGVjaWFsIGZpbHRlcl8yXG5pZiAodGFzayA9PT0gVGFzay5nZXRUYXJnZXRDYXNoaWVyczIpIHtcbiAgZGIuZ2V0VGFyZ2V0Q2FzaGllcnMyKCk7XG59XG5cbi8vIGNsb3NlIERCIGFuZCBjb25uZWN0aW9uXG5pZiAoIXRhc2spIHtcbiAgZGIuY2xvc2UoKTtcbn1cbiJdfQ==