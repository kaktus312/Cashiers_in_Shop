"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.ShopDB = void 0;
const sqlite3_1 = require("sqlite3");
const models_1 = require("./models");
const utils_1 = require("./utils");
class ShopDB {
    constructor(dbPath) {
        console.log(dbPath);
        this.db = new sqlite3_1.Database(dbPath);
    }
    close() {
        this.db.close();
    }
    addCashier(cashier) {
        console.log(`Данные по кассиру ${cashier.employeeName.lastName} успешно добавлены в БД`);
        const sql = 'SELECT id FROM Cashier WHERE rowid=last_insert_rowid();';
        let id = -1;
        this.db.get(sql, (res, err) => {
            if (res) {
                id = res;
            }
        });
        return id;
    }
    getCashierById(id) {
        return new Promise((res, rej) => {
            this.db.get(`SELECT Cashier.*, Address.city, Address.street, Address.building, Address.litera, Address.apartment FROM Cashier, Address Where Cashier.addrID = Address.id AND Cashier.id=${id};`, (err, row) => {
                if (row) {
                    const cashier = utils_1.parceCashier(row);
                    res(cashier);
                }
            });
        });
    }
    updateCashier(cashier) {
        let sql = `SELECT addrID FROM Cashier WHERE id='${cashier.id}'`;
        this.db.get(sql, (err, addrIdRow) => {
            if (err) {
                console.log(err);
                console.log(sql);
                return;
            }
            console.log(addrIdRow);
            sql = `UPDATE Address SET city = '${models_1.City[cashier.addr.city]}', street = '${cashier.addr.street}', building = '${cashier.addr.building}', litera = '${cashier.addr.litera}', apartment = '${cashier.addr.apartment}' WHERE id=${addrIdRow.addrID}`;
            this.db.get(sql, (errUpdAddr, resRow) => {
                if (errUpdAddr) {
                    console.log(errUpdAddr);
                    return;
                }
                console.log(sql);
                sql = `UPDATE Cashier SET personnelNumber = '${cashier.personnelNumber}', lastName = '${cashier.employeeName.lastName}', firstName = '${cashier.employeeName.firstName}', patronymic = '${cashier.employeeName.patronymic}', sex = '${models_1.Sex[cashier.sex]}', phone = '${cashier.phone}', addrID = '${addrIdRow.addrID}', birthday = '${utils_1.dateFormat(cashier.birthday)}', shopID = '${cashier.shopID}', startWork = '${cashier.startWork}', lastNet = '${models_1.Net[cashier.lastNet]}' WHERE id='${cashier.id}'`;
                console.log(sql);
                this.db.run(sql, (resUdate, errUpdate) => {
                    if (errUpdate) {
                        console.log(errUpdate);
                        return;
                    }
                    console.log(`Данные кассира ${cashier.employeeName.lastName} успешно обновлены`);
                });
            });
        });
    }
    delCashier(id) {
        const sql = `UPDATE Cashier SET deleted = 1 WHERE id='${id}'`;
        this.db.run(sql, (res, err) => {
            console.log(sql);
            if (err) {
                console.log(err);
                return;
            }
            console.log(`Информация о кассире с ${id} успешно удалена`);
        });
    }
    completDeleteCashier(id) {
        const sql = `DELETE FROM Cashier WHERE id='${id}'`;
        this.db.run(sql, (res, err) => {
            console.log(sql);
            if (err) {
                console.log(err);
                return;
            }
            console.log(`Информация о кассире с ${id} успешно удалена`);
        });
    }
    getAllCashiers() {
        console.log('Информация о всех кассирах:');
        this.db.each('SELECT Cashier.*, Address.* FROM Cashier, Address Where Cashier.addrID = Address.id;', (err, row) => {
            if (row) {
                console.log(utils_1.parceCashier(row));
            }
        });
    }
    getTargetCashiers1() {
        console.log('Данi по усіх касирах магазину за всю історію роботи магазинів ATB у місті Львів, які мають більше 5 років досвіду та раніше працювали у Silpo або Arsen:');
    }
    getTargetCashiers2() {
        console.log('Данi по усіх касирах магазину ATB за адресою Шевенка 100, які працюють на касах з непарним числом щопонеділка у нічну зміну (23:00 - 07:00)');
    }
}
exports.ShopDB = ShopDB;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvZGIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0FBQ0EscUNBQW1DO0FBQ25DLHFDQUVrQjtBQUNsQixtQ0FBbUQ7QUEyQm5ELE1BQWEsTUFBTTtJQUdqQixZQUFZLE1BQWE7UUFDdkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNwQixJQUFJLENBQUMsRUFBRSxHQUFHLElBQUksa0JBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNqQyxDQUFDO0lBS00sS0FBSztRQUNWLElBQUksQ0FBQyxFQUFFLENBQUMsS0FBSyxFQUFFLENBQUM7SUFDbEIsQ0FBQztJQUtNLFVBQVUsQ0FBQyxPQUFnQjtRQUNoQyxPQUFPLENBQUMsR0FBRyxDQUFDLHFCQUFxQixPQUFPLENBQUMsWUFBWSxDQUFDLFFBQVEseUJBQXlCLENBQUMsQ0FBQztRQUN6RixNQUFNLEdBQUcsR0FBVSx5REFBeUQsQ0FBQztRQUM3RSxJQUFJLEVBQUUsR0FBVSxDQUFDLENBQUMsQ0FBQztRQUNuQixJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFVLEVBQUUsR0FBTyxFQUFFLEVBQUU7WUFDdkMsSUFBSSxHQUFHLEVBQUU7Z0JBQ1AsRUFBRSxHQUFHLEdBQUcsQ0FBQzthQUNWO1FBQ0gsQ0FBQyxDQUFDLENBQUM7UUFDSCxPQUFPLEVBQUUsQ0FBQztJQUNaLENBQUM7SUFZTSxjQUFjLENBQUMsRUFBUztRQUM3QixPQUFPLElBQUksT0FBTyxDQUFDLENBQUMsR0FBRyxFQUFFLEdBQUcsRUFBRSxFQUFFO1lBQzlCLElBQUksQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLDhLQUE4SyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQVEsRUFBRSxHQUFRLEVBQUUsRUFBRTtnQkFDdE4sSUFBSSxHQUFHLEVBQUU7b0JBQ1AsTUFBTSxPQUFPLEdBQVksb0JBQVksQ0FBQyxH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UjtZQUNELE9BQU8sQ0FBQyxHQUFHLENBQUMsMEJBQTBCLEVBQUUsa0JBQWtCLENBQUMsQ0FBQztRQUM5RCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFLTSxvQkFBb0IsQ0FBQyxFQUFTO1FBQ25DLE1BQU0sR0FBRyxHQUFHLGlDQUFpQyxFQUFFLEdBQUcsQ0FBQztRQUNuRCxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxHQUFPLEVBQUUsR0FBTyxFQUFFLEVBQUU7WUFDcEMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUNqQixJQUFJLEdBQUcsRUFBRTtnQkFDUCxPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO2dCQUNqQixPQUFPO2FBQ1I7WUFDRCxPQUFPLENBQUMsR0FBRyxDQUFDLDBCQUEwQixFQUFFLGtCQUFrQixDQUFDLENBQUM7UUFDOUQsQ0FBQyxDQUFDLENBQUM7SUFDTCxDQUFDO0lBS00sY0FBYztRQUNuQixPQUFPLENBQUMsR0FBRyxDQUFDLDZCQUE2QixDQUFDLENBQUM7UUFDM0MsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsc0ZBQXNGLEVBQUUsQ0FBQyxHQUFRLEVBQUUsR0FBUSxFQUFFLEVBQUU7WUFDMUgsSUFBSSxHQUFHLEVBQUU7Z0JBQ1AsT0FBTyxDQUFDLEdBQUcsQ0FBQyxvQkFBWSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUM7YUFDaEM7UUFDSCxDQUFDLENBQUMsQ0FBQztJQUNMLENBQUM7SUFLTSxrQkFBa0I7UUFDdkIsT0FBTyxDQUFDLEdBQUcsQ0FBQywwSkFBMEosQ0FBQyxDQUFDO0lBUTFLLENBQUM7SUFLTSxrQkFBa0I7UUFDdkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyw2SUFBNkksQ0FBQyxDQUFDO0lBQzdKLENBQUM7Q0FDRjtBQXBKRCx3QkFvSkMiLCJzb3VyY2VzQ29udGVudCI6WyIvLyBtYWluIG1ldGhvZHMgKENSVUQpICsgZGIgY29ubmVjdGlvbjsgaW1wb3J0cyBzdHVmZiBmcm9tIG1vZGVscy50c1xuaW1wb3J0IHsgRGF0YWJhc2UgfSBmcm9tICdzcWxpdGUzJztcbmltcG9ydCB7XG4gIElDYXNoaWVyLCBOZXQsIFNleCwgQ2l0eSxcbn0gZnJvbSAnLi9tb2RlbHMnO1xuaW1wb3J0IHsgZGF0ZUZvcm1hdCwgcGFyY2VDYXNoaWVyIH0gZnJvbSAnLi91dGlscyc7XG5cbi8vIGNvbnN0IHNxbGl0ZTMgPSByZXF1aXJlKCdzcWxpdGUzJykudmVyYm9zZSgpO1xuLy8gY29uc3Qgc3FsaXRlMyA9IHJlcXVpcmUoJ3NxbGl0ZTMnKS52ZXJib3NlKCk7XG4vLyBjb25zdCBkYiA9IG5ldyBzcWxpdGUzLkRhdGFiYXNlKCc6bWVtb3J5OicpO1xuLy8gY29uc3QgZGIgPSBuZXcgc3FsaXRlMy5EYXRhYmFzZSgnLi9kYi5zcWxpdGUnKTtcblxuLy8gZGIuc2VyaWFsaXplKCgpID0+IHtcbi8vICAgY29uc3QgcmVzID0gZGIuZ2V0KCdTRUxFQ1QgbmFtZSBGUk9NIHNxbGl0ZV9tYXN0ZXIgV0hFUkUgdHlwZT1cInRhYmxlXCIgQU5EIG5hbWU9PycsICdsb3JlbScpO1xuLy8gICBpZiAoIXJlcykge1xuLy8gICAgIGRiLnJ1bignQ1JFQVRFIFRBQkxFIGxvcmVtIChpbmZvIFRFWFQpJyk7XG4vLyAgIH1cblxuLy8gICBjb25zdCBzdG10ID0gZGIucHJlcGFyZSgnSU5TRVJUIElOVE8gbG9yZW0gVkFMVUVTICg/KScpO1xuLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpICs9IDEpIHtcbi8vICAgICBzdG10LnJ1bihgSXBzdW0gJHtpfWApO1xuLy8gICB9XG4vLyAgIHN0bXQuZmluYWxpemUoKTtcblxuLy8gZGIuZWFjaCgnU0VMRUNUIHJvd2lkIEFTIGlkLCBpbmZvIEZST00gbG9yZW0nLChlcnI6IGFueSwgcm93OiB7IGlkOiBzdHJpbmc7IGluZm86IHN0cmluZzsgfSkgPT4ge1xuLy8gICAgIGNvbnNvbGUubG9nKGAke3Jvdy5pZH06ICR7cm93LmluZm99YCk7XG4vLyAgIH0pO1xuLy8gfSk7XG5cbi8vIGRiLmNsb3NlKCk7XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBpbXBvcnQvcHJlZmVyLWRlZmF1bHQtZXhwb3J0XG5leHBvcnQgY2xhc3MgU2hvcERCIHtcbiAgcHJpdmF0ZSBkYjpEYXRhYmFzZTtcblxuICBjb25zdHJ1Y3RvcihkYlBhdGg6c3RyaW5nKSB7XG4gICAgY29uc29sZS5sb2coZGJQYXRoKTtcbiAgICB0aGlzLmRiID0gbmV3IERhdGFiYXNlKGRiUGF0aCk7XG4gIH1cblxuICAvKipcbiAgICAgICAqIENsb3NlIG9wZW5lZCBEQlxuICAgICAgICovXG4gIHB1YmxpYyBjbG9zZSgpOnZvaWQge1xuICAgIHRoaXMuZGIuY2xvc2UoKTtcbiAgfVxuXG4gIC8qKlxuICAgICAgICogQWRkIGEgbmV3IENhc2hpZXIgaW4gdG8gdGhlIERCXG4gICAgICAgKi9cbiAgcHVibGljIGFkZENhc2hpZXIoY2FzaGllcjpJQ2FzaGllcik6bnVtYmVyIHtcbiAgICBjb25zb2xlLmxvZyhg0JTQsNC90L3Ri9C1INC/0L4g0LrQsNGB0YHQuNGA0YMgJHtjYXNoaWVyLmVtcGxveWVlTmFtZS5sYXN0TmFtZX0g0YPRgdC/0LXRiNC90L4g0LTQvtCx0LDQstC70LXQvdGLINCyINCR0JRgKTtcbiAgICBjb25zdCBzcWw6c3RyaW5nID0gJ1NFTEVDVCBpZCBGUk9NIENhc2hpZXIgV0hFUkUgcm93aWQ9bGFzdF9pbnNlcnRfcm93aWQoKTsnO1xuICAgIGxldCBpZDpudW1iZXIgPSAtMTtcbiAgICB0aGlzLmRiLmdldChzcWwsIChyZXM6bnVtYmVyLCBlcnI6YW55KSA9PiB7XG4gICAgICBpZiAocmVzKSB7XG4gICAgICAgIGlkID0gcmVzO1xuICAgICAgfVxuICAgIH0pO1xuICAgIHJldHVybiBpZDtcbiAgfVxuXG4gIC8vIGNvbnN0IHN0bXQgPSB0aGlzLmRiLnByZXBhcmUoJ0lOU0VSVCBJTlRPIENhc2hpZXIgVkFMVUVTICg/KScpO1xuICAvLyBmb3IgKGxldCBpID0gMDsgaSA8IDEwOyBpICs9IDEpIHtcbiAgLy8gICBzdG10LnJ1bihgSXBzdW0gJHtpfWApO1xuICAvLyB9XG4gIC8vIC8vIGNhc2hpZXIuYWRkci5jaXR5XG4gIC8vIHN0bXQuZmluYWxpemUoKTtcblxuICAvKipcbiAgICAgICAqIEdldCBpbmZvcm1hdGlvbiBhYm91dCBhIENhc2hpZXIgYnkgSURcbiAgICAgICAqL1xuICBwdWJsaWMgZ2V0Q2FzaGllckJ5SWQoaWQ6bnVtYmVyKTpQcm9taXNlPElDYXNoaWVyPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xuICAgICAgdGhpcy5kYi5nZXQoYFNFTEVDVCBDYXNoaWVyLiosIEFkZHJlc3MuY2l0eSwgQWRkcmVzcy5zdHJlZXQsIEFkZHJlc3MuYnVpbGRpbmcsIEFkZHJlc3MubGl0ZXJhLCBBZGRyZXNzLmFwYXJ0bWVudCBGUk9NIENhc2hpZXIsIEFkZHJlc3MgV2hlcmUgQ2FzaGllci5hZGRySUQgPSBBZGRyZXNzLmlkIEFORCBDYXNoaWVyLmlkPSR7aWR9O2AsIChlcnI6IGFueSwgcm93OiBhbnkpID0+IHtcbiAgICAgICAgaWYgKHJvdykge1xuICAgICAgICAgIGNvbnN0IGNhc2hpZXI6SUNhc2hpZXIgPSBwYXJjZUNhc2hpZXIocm93KTtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhg0JTQsNC90L3Ri9C1INC+INC60LDRgdGB0LjRgNC1INGBIGlkICR7aWR9OlxcbmAsIGNhc2hpZXIpO1xuICAgICAgICAgIHJlcyhjYXNoaWVyKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICAgICAqIFVwZGF0ZSBpbmZvcm1hdGlvbiBhYm91dCBhIENhc2hpZXJcbiAgICAgICAqL1xuICBwdWJsaWMgdXBkYXRlQ2FzaGllcihjYXNoaWVyOklDYXNoaWVyKTp2b2lkIHtcbiAgICBsZXQgc3FsOnN0cmluZyA9IGBTRUxFQ1QgYWRkcklEIEZST00gQ2FzaGllciBXSEVSRSBpZD0nJHtjYXNoaWVyLmlkfSdgO1xuICAgIHRoaXMuZGIuZ2V0KHNxbCwgKGVycjphbnksIGFkZHJJZFJvdzphbnkpID0+IHtcbiAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcbiAgICAgICAgY29uc29sZS5sb2coc3FsKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgY29uc29sZS5sb2coYWRkcklkUm93KTtcblxuICAgICAgc3FsID0gYFVQREFURSBBZGRyZXNzIFNFVCBjaXR5ID0gJyR7Q2l0eVtjYXNoaWVyLmFkZHIuY2l0eV19Jywgc3RyZWV0ID0gJyR7Y2FzaGllci5hZGRyLnN0cmVldH0nLCBidWlsZGluZyA9ICcke2Nhc2hpZXIuYWRkci5idWlsZGluZ30nLCBsaXRlcmEgPSAnJHtjYXNoaWVyLmFkZHIubGl0ZXJhfScsIGFwYXJ0bWVudCA9ICcke2Nhc2hpZXIuYWRkci5hcGFydG1lbnR9JyBXSEVSRSBpZD0ke2FkZHJJZFJvdy5hZGRySUR9YDtcbiAgICAgIHRoaXMuZGIuZ2V0KHNxbCwgKGVyclVwZEFkZHI6YW55LCByZXNSb3c6bnVtYmVyKSA9PiB7XG4gICAgICAgIGlmIChlcnJVcGRBZGRyKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coZXJyVXBkQWRkcik7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKHNxbCk7XG5cbiAgICAgICAgc3FsID0gYFVQREFURSBDYXNoaWVyIFNFVCBwZXJzb25uZWxOdW1iZXIgPSAnJHtjYXNoaWVyLnBlcnNvbm5lbE51bWJlcn0nLCBsYXN0TmFtZSA9ICcke2Nhc2hpZXIuZW1wbG95ZWVOYW1lLmxhc3ROYW1lfScsIGZpcnN0TmFtZSA9ICcke2Nhc2hpZXIuZW1wbG95ZWVOYW1lLmZpcnN0TmFtZX0nLCBwYXRyb255bWljID0gJyR7Y2FzaGllci5lbXBsb3llZU5hbWUucGF0cm9ueW1pY30nLCBzZXggPSAnJHtTZXhbY2FzaGllci5zZXhdIGFzIHVua25vd24gYXMgbnVtYmVyfScsIHBob25lID0gJyR7Y2FzaGllci5waG9uZX0nLCBhZGRySUQgPSAnJHthZGRySWRSb3cuYWRkcklEfScsIGJpcnRoZGF5ID0gJyR7ZGF0ZUZvcm1hdChjYXNoaWVyLmJpcnRoZGF5KX0nLCBzaG9wSUQgPSAnJHtjYXNoaWVyLnNob3BJRH0nLCBzdGFydFdvcmsgPSAnJHtjYXNoaWVyLnN0YXJ0V29ya30nLCBsYXN0TmV0ID0gJyR7TmV0W2Nhc2hpZXIubGFzdE5ldF0gYXMgdW5rbm93biBhcyBudW1iZXJ9JyBXSEVSRSBpZD0nJHtjYXNoaWVyLmlkfSdgO1xuICAgICAgICBjb25zb2xlLmxvZyhzcWwpO1xuICAgICAgICB0aGlzLmRiLnJ1bihzcWwsIChyZXNVZGF0ZTphbnksIGVyclVwZGF0ZTphbnkpID0+IHtcbiAgICAgICAgICBpZiAoZXJyVXBkYXRlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJVcGRhdGUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zb2xlLmxvZyhg0JTQsNC90L3Ri9C1INC60LDRgdGB0LjRgNCwICR7Y2FzaGllci5lbXBsb3llZU5hbWUubGFzdE5hbWV9INGD0YHQv9C10YjQvdC+INC+0LHQvdC+0LLQu9C10L3Ri2ApO1xuICAgICAgICB9KTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAgICogTWFyayBzb21lIENhc2hpZXIgYXMgYSBkZWxldGVkIHdpdGhvdXQgZGVsZXRpbmcgZnJvbSB0aGUgREJcbiAgICAgKi9cbiAgcHVibGljIGRlbENhc2hpZXIoaWQ6bnVtYmVyKTp2b2lkIHtcbiAgICBjb25zdCBzcWwgPSBgVVBEQVRFIENhc2hpZXIgU0VUIGRlbGV0ZWQgPSAxIFdIRVJFIGlkPScke2lkfSdgO1xuICAgIHRoaXMuZGIucnVuKHNxbCwgKHJlczphbnksIGVycjphbnkpID0+IHtcbiAgICAgIGNvbnNvbGUubG9nKHNxbCk7XG4gICAgICBpZiAoZXJyKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKGDQmNC90YTQvtGA0LzQsNGG0LjRjyDQviDQutCw0YHRgdC40YDQtSDRgSAke2lkfSDRg9GB0L/QtdGI0L3QviDRg9C00LDQu9C10L3QsGApO1xuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAgICogRGVsZXRlIGEgQ2FzaGllciBmcm9tIHRoZSBEQlxuICAgICAqL1xuICBwdWJsaWMgY29tcGxldERlbGV0ZUNhc2hpZXIoaWQ6bnVtYmVyKTp2b2lkIHtcbiAgICBjb25zdCBzcWwgPSBgREVMRVRFIEZST00gQ2FzaGllciBXSEVSRSBpZD0nJHtpZH0nYDtcbiAgICB0aGlzLmRiLnJ1bihzcWwsIChyZXM6YW55LCBlcnI6YW55KSA9PiB7XG4gICAgICBjb25zb2xlLmxvZyhzcWwpO1xuICAgICAgaWYgKGVycikge1xuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBjb25zb2xlLmxvZyhg0JjQvdGE0L7RgNC80LDRhtC40Y8g0L4g0LrQsNGB0YHQuNGA0LUg0YEgJHtpZH0g0YPRgdC/0LXRiNC90L4g0YPQtNCw0LvQtdC90LBgKTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgaW5mb3JtYXRpb24gYWJvdXQgYWxsIENhc2hpZXJzIGluIHRoZSBTaG9wXG4gICAqL1xuICBwdWJsaWMgZ2V0QWxsQ2FzaGllcnMoKTp2b2lkIHtcbiAgICBjb25zb2xlLmxvZygn0JjQvdGE0L7RgNC80LDRhtC40Y8g0L4g0LLRgdC10YUg0LrQsNGB0YHQuNGA0LDRhTonKTtcbiAgICB0aGlzLmRiLmVhY2goJ1NFTEVDVCBDYXNoaWVyLiosIEFkZHJlc3MuKiBGUk9NIENhc2hpZXIsIEFkZHJlc3MgV2hlcmUgQ2FzaGllci5hZGRySUQgPSBBZGRyZXNzLmlkOycsIChlcnI6IGFueSwgcm93OiBhbnkpID0+IHtcbiAgICAgIGlmIChyb3cpIHtcbiAgICAgICAgY29uc29sZS5sb2cocGFyY2VDYXNoaWVyKHJvdykpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIGdldFRhcmdldENhc2hpZXJzMVxuICAgKi9cbiAgcHVibGljIGdldFRhcmdldENhc2hpZXJzMSgpOnZvaWQge1xuICAgIGNvbnNvbGUubG9nKCfQlNCw0L1pINC/0L4g0YPRgdGW0YUg0LrQsNGB0LjRgNCw0YUg0LzQsNCz0LDQt9C40L3RgyDQt9CwINCy0YHRjiDRltGB0YLQvtGA0ZbRjiDRgNC+0LHQvtGC0Lgg0LzQsNCz0LDQt9C40L3RltCyIEFUQiDRgyDQvNGW0YHRgtGWINCb0YzQstGW0LIsINGP0LrRliDQvNCw0Y7RgtGMINCx0ZbQu9GM0YjQtSA1INGA0L7QutGW0LIg0LTQvtGB0LLRltC00YMg0YLQsCDRgNCw0L3RltGI0LUg0L/RgNCw0YbRjtCy0LDQu9C4INGDIFNpbHBvINCw0LHQviBBcnNlbjonKTtcbiAgICAvLyBjb25zdCBzcWw6c3RyaW5nID0gYFNFTEVDVCBDYXNoaWVyLiosIEFkZHJlc3MuKiBGUk9NIENhc2hpZXIsIEFkZHJlc3MgV2hlcmUgQ2FzaGllci5hZGRySUQgPSBBZGRyZXNzLmlkIEFORCBBZGRyZXNzLkNpdHkgPSAnJHtDaXR5W0NpdHku0JvRjNCy0L7Qsl19JyBBTkQgc3RhcnRXb3JrPD0nMjAxNi0wMS0wMScgQU5EIGxhc3ROZXQgSU4gKCR7TmV0LtChadC70YzQv9C+fSAsICR7TmV0LtCQ0YDRgdC10L19KTtgO1xuICAgIC8vIGNvbnNvbGUubG9nKHNxbCk7XG4gICAgLy8gdGhpcy5kYi5lYWNoKHNxbCwgKGVycjogYW55LCByb3c6IGFueSkgPT4ge1xuICAgIC8vICAgaWYgKHJvdykge1xuICAgIC8vICAgICBjb25zb2xlLmxvZyhwYXJjZUNhc2hpZXIocm93KSk7XG4gICAgLy8gICB9XG4gICAgLy8gfSk7XG4gIH1cblxuICAvKipcbiAgICogZ2V0VGFyZ2V0Q2FzaGllcnMyXG4gICAqL1xuICBwdWJsaWMgZ2V0VGFyZ2V0Q2FzaGllcnMyKCk6dm9pZCB7XG4gICAgY29uc29sZS5sb2coJ9CU0LDQvWkg0L/QviDRg9GB0ZbRhSDQutCw0YHQuNGA0LDRhSDQvNCw0LPQsNC30LjQvdGDIEFUQiDQt9CwINCw0LTRgNC10YHQvtGOINCo0LXQstC10L3QutCwIDEwMCwg0Y/QutGWINC/0YDQsNGG0Y7RjtGC0Ywg0L3QsCDQutCw0YHQsNGFINC3INC90LXQv9Cw0YDQvdC40Lwg0YfQuNGB0LvQvtC8INGJ0L7Qv9C+0L3QtdC00ZbQu9C60LAg0YMg0L3RltGH0L3RgyDQt9C80ZbQvdGDICgyMzowMCAtIDA3OjAwKScpO1xuICB9XG59XG4iXX0=